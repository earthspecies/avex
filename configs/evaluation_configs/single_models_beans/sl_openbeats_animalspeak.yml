# SL-OpenBEATs-AnimalSpeak: Supervised finetuned OpenBEATs evaluation on BEANS
# Evaluates frozen encoder with linear probe on bioacoustic classification/detection tasks
#
# This evaluates OpenBEATs AFTER supervised finetuning on AnimalSpeak dataset
# Workflow: 1) Finetune OpenBEATs on AnimalSpeak â†’ 2) Evaluate on BEANS with frozen encoder

# On which datasets to run the evaluation and which metrics to use
dataset_config: configs/data_configs/benchmark_beans.yml

training_params:
  train_epochs: 900
  lr: 0.001
  batch_size: 32
  optimizer: adamw
  weight_decay: 0.01
  amp: false
  amp_dtype: bf16

# Which experiments to evaluate
experiments:
  - run_name: sl_openbeats_animalspeak
    run_config: configs/run_configs/pretrained/openbeats_eval.yml
    probe_config:
      probe_type: linear
      target_layers: ["backbone"]
      aggregation: "mean"
      input_processing: "pooled"
      freeze_backbone: true
      online_training: false
    ### Use finetuned checkpoint, not pretrained
    pretrained: false
    # TODO: Update this path after finetuning completes
    # checkpoint_path: gs://representation-learning/models/sl_openbeats_animalspeak.pt
    checkpoint_path: runs/openbeats_ft/checkpoints/final_model.pt

# Where to save the evaluation results
save_dir: evaluation_results/aaai/sl_openbeats_animalspeak

# Optional: Append results to a global CSV file for cross-model comparison
results_csv_path: evaluation_results/all_models_results.csv

device: cuda

seed: 42

num_workers: 8  # Enable workers for better memory management

# Evaluation phases
eval_modes:
  - probe
  - retrieval
  - clustering

offline_embeddings:
  overwrite_embeddings: true
